<!DOCTYPE html><html lang="en-US" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.0" /><meta property="og:title" content="开发Tips02-AOP+注解实现日志打印方法入参返回值" /><meta name="author" content="ifuncat" /><meta property="og:locale" content="en_US" /><meta name="description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><meta property="og:description" content="A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation." /><link rel="canonical" href="https://ifuncat.github.io/posts/devTips02-methodLogAspect/" /><meta property="og:url" content="https://ifuncat.github.io/posts/devTips02-methodLogAspect/" /><meta property="og:site_name" content="ifuncat" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-08T22:22:22+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="开发Tips02-AOP+注解实现日志打印方法入参返回值" /><meta name="twitter:site" content="@ifuncat" /><meta name="twitter:creator" content="@ifuncat" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"ifuncat"},"description":"A minimal, portfolio, sidebar, bootstrap Jekyll theme with responsive web design and focuses on text presentation.","url":"https://ifuncat.github.io/posts/devTips02-methodLogAspect/","headline":"开发Tips02-AOP+注解实现日志打印方法入参返回值","dateModified":"2021-06-02T07:03:14+08:00","datePublished":"2021-05-08T22:22:22+08:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://ifuncat.github.io/posts/devTips02-methodLogAspect/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>开发Tips02-AOP+注解实现日志打印方法入参返回值 | ifuncat</title><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="icon" href="/assets/img/favicons/favicon.ico" type="image/x-icon"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon.png"><link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"><link rel="apple-touch-icon" sizes="57x57" href="/assets/img/favicons/apple-icon-57x57.png"><link rel="apple-touch-icon" sizes="60x60" href="/assets/img/favicons/apple-icon-60x60.png"><link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"><link rel="apple-touch-icon" sizes="76x76" href="/assets/img/favicons/apple-icon-76x76.png"><link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"><link rel="apple-touch-icon" sizes="120x120" href="/assets/img/favicons/apple-icon-120x120.png"><link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"><link rel="apple-touch-icon" sizes="152x152" href="/assets/img/favicons/apple-icon-152x152.png"><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-icon-180x180.png"><link rel="icon" type="image/png" sizes="192x192" href="/assets/img/favicons/android-icon-192x192.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="96x96" href="/assets/img/favicons/favicon-96x96.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/manifest.json"><meta name='msapplication-config' content='/assets/img/favicons/browserconfig.xml'><meta name="msapplication-TileColor" content="#ffffff"><meta name="msapplication-TileImage" content="/assets/img/favicons/ms-icon-144x144.png"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/ifuncat/blog-images/common/avatar.jpeg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">ifuncat</a></div><div class="site-subtitle font-italic">stay hungry & foolish</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/ifuncat" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/ifuncat" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['ifuncat','163.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>开发Tips02-AOP+注解实现日志打印方法入参返回值</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>开发Tips02-AOP+注解实现日志打印方法入参返回值</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> ifuncat </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, May 8, 2021, 10:22 PM +0800" prep="on" > May 8 <i class="unloaded">2021-05-08T22:22:22+08:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Wed, Jun 2, 2021, 7:03 AM +0800" prefix="Updated " > Jun 2 <i class="unloaded">2021-06-02T07:03:14+08:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1472 words">8 min</span></div></div><div class="post-content"><style> img{ padding-left: 3%; }</style><h3 id="概述">概述</h3><p>利用SpringAOP+自定义注解实现打印方法的入参和返回值, 避免在方法前后编写重复的输出日志代码.</p><h3 id="实现过程介绍">实现过程介绍</h3><p>实现过程主要分为两步:</p><h4 id="1-自定义以下两个个注解">1. 自定义以下两个个注解</h4><ul><li>@MethodLog<br /> 可以用于方法或类上, 用在方法上表明需要对该方法打印入参和返回结果, 用在类上表明需要 对该类下的所有public方法打印入参和返回结果.<br /> 有一个属性httpInfoFlag, 默认false, 即日志中不打印http方法信息, true则相反.<li>@MethodLogIgnore<br /> 用于方法, 用在方法上表明无需对该方法打印入参和返回结果.<br /> 如果使用了@MethodLog类的某个方法不想打印入参和返回结果, 就可以使用该注解.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">,</span> <span class="nc">ElementType</span><span class="o">.</span><span class="na">TYPE</span><span class="o">})</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MethodLog</span> <span class="o">{</span>
    <span class="kt">boolean</span> <span class="nf">httpInfoFlag</span><span class="o">()</span> <span class="k">default</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">//false: 日志中不打印http方法信息, true则相反</span>
<span class="o">}</span>

<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">METHOD</span><span class="o">})</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MethodLogIgnore</span> <span class="o">{</span>
<span class="o">}</span>
</pre></table></code></div></div><h4 id="2-定义日志切面">2. 定义日志切面</h4><ul><li>确定切点: 切点为使用了@MethodLog的类的public方法和使用了@MethodLog的方法.<li>使用环绕通知: 需要记录方法的入参和返回结果.<li>确定是否需要对切点打印日志: 如果某一切点上同时使用了@MethodLogIgnore, 则不对该方法打印入参/返回值日志.<li>确定是否需要打印方法的http信息: 使用反射拿到@MethodLog的httpInfoFlag属性的值, 如果为false, 即日志中不打印http方法信息, true则相反.<li>根据反射拿到方法的静态信息, 参数列表, 执行方法获得返回值, 结合方法执行耗时, 组装一个对象, 日志打印成这个对象的json串.</ul><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@Aspect</span>
<span class="nd">@Slf4j</span> <span class="c1">//lombok</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MethodLogAspect</span> <span class="o">{</span>
    <span class="cm">/**
     * 作用于类上使用@MethodLog的该类下的所有方法, 或者作用于方法使用@MethodLog的该方法
     */</span>
    <span class="nd">@Around</span><span class="o">(</span><span class="s">"@within(com.ifuncat.demo.export.methodLogAop.annotation.MethodLog) || @annotation(com.ifuncat.demo.export.methodLogAop.annotation.MethodLog)"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Object</span> <span class="nf">doAround</span><span class="o">(</span><span class="nc">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">Throwable</span> <span class="o">{</span>
        <span class="c1">//方法反射对象</span>
        <span class="nc">Method</span> <span class="n">method</span> <span class="o">=</span> <span class="o">((</span><span class="nc">MethodSignature</span><span class="o">)</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getMethod</span><span class="o">();</span>
        <span class="c1">//方法所在的类的实例对象</span>
        <span class="nc">Object</span> <span class="n">target</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getTarget</span><span class="o">();</span>

        <span class="c1">//判断是否打印方法日志,日志中是否需要http方法信息</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">logHttpFlagMap</span> <span class="o">=</span> <span class="n">checkLogHttpInfo</span><span class="o">(</span><span class="n">method</span><span class="o">);</span>
        <span class="nc">Boolean</span> <span class="n">methodLogFlag</span> <span class="o">=</span> <span class="n">logHttpFlagMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"methodLogFlag"</span><span class="o">);</span>
        <span class="nc">Boolean</span> <span class="n">httpInfoFlag</span> <span class="o">=</span> <span class="n">logHttpFlagMap</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"httpInfoFlag"</span><span class="o">);</span>
        <span class="c1">//日志信息</span>
        <span class="nc">MethodLogInfo</span> <span class="n">methodLogInfo</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MethodLogInfo</span><span class="o">();</span>

        <span class="k">try</span> <span class="o">{</span>
            <span class="kt">long</span> <span class="n">start</span> <span class="o">=</span> <span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">();</span>
            <span class="c1">//java原生反射调用,如果该切面的注解被其他子工程引用,joinPoint.proceed()的执行结果都为null,故使用java原生反射调用</span>
            <span class="nc">Object</span> <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">invoke</span><span class="o">(</span><span class="n">target</span><span class="o">,</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getArgs</span><span class="o">());</span>

            <span class="k">if</span> <span class="o">(</span><span class="n">methodLogFlag</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//组装方法信息</span>
                <span class="n">buildMethodInfo</span><span class="o">(</span><span class="n">methodLogInfo</span><span class="o">,</span> <span class="n">joinPoint</span><span class="o">,</span> <span class="n">httpInfoFlag</span><span class="o">);</span>
                <span class="n">methodLogInfo</span><span class="o">.</span><span class="na">setTimeCost</span><span class="o">((</span><span class="nc">System</span><span class="o">.</span><span class="na">currentTimeMillis</span><span class="o">()</span> <span class="o">-</span> <span class="n">start</span><span class="o">)</span> <span class="o">+</span> <span class="s">"ms"</span><span class="o">);</span>
                <span class="n">methodLogInfo</span><span class="o">.</span><span class="na">setResult</span><span class="o">(</span><span class="n">result</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"---MethodLog: {}"</span><span class="o">,</span> <span class="no">JSON</span><span class="o">.</span><span class="na">toJSONString</span><span class="o">(</span><span class="n">methodLogInfo</span><span class="o">));</span>
            <span class="o">}</span>

            <span class="k">return</span> <span class="n">result</span><span class="o">;</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">Throwable</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">methodLogFlag</span><span class="o">)</span> <span class="o">{</span>
                <span class="c1">//组装方法信息,发生异常必须记录http信息</span>
                <span class="n">buildMethodInfo</span><span class="o">(</span><span class="n">methodLogInfo</span><span class="o">,</span> <span class="n">joinPoint</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
                <span class="n">log</span><span class="o">.</span><span class="na">error</span><span class="o">(</span><span class="s">"---MethodLog error: {}"</span><span class="o">,</span> <span class="no">JSON</span><span class="o">.</span><span class="na">toJSONString</span><span class="o">(</span><span class="n">methodLogInfo</span><span class="o">));</span>
            <span class="o">}</span>
            <span class="k">throw</span> <span class="n">e</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 判断是否打印方法日志, 及判断是否打印http方法信息
     */</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">&gt;</span> <span class="nf">checkLogHttpInfo</span><span class="o">(</span><span class="nc">Method</span> <span class="n">method</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//在方法所在类上使用@MethodLog, 打印日志</span>
        <span class="nc">MethodLog</span> <span class="n">typeAnnotation</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getDeclaringClass</span><span class="o">().</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MethodLog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//在方法上使用@MethodLog, 打印日志, 如果该方法所在类也使用了@MethodLog, 以方法的注解为准</span>
        <span class="nc">MethodLog</span> <span class="n">methodAnnotation</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MethodLog</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="c1">//在方法上使用@MethodLogIgnore, 不打印日志</span>
        <span class="nc">MethodLogIgnore</span> <span class="n">methodLogIgnore</span> <span class="o">=</span> <span class="n">method</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MethodLogIgnore</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

        <span class="kt">boolean</span> <span class="n">methodLogFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">//默认打印日志</span>
        <span class="kt">boolean</span> <span class="n">httpInfoFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span> <span class="c1">//默认不打印http信息</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">methodLogIgnore</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">methodLogFlag</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">typeAnnotation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">httpInfoFlag</span> <span class="o">=</span> <span class="n">typeAnnotation</span><span class="o">.</span><span class="na">httpInfoFlag</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">methodAnnotation</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">httpInfoFlag</span> <span class="o">=</span> <span class="n">methodAnnotation</span><span class="o">.</span><span class="na">httpInfoFlag</span><span class="o">();</span>
        <span class="o">}</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Boolean</span><span class="o">&gt;</span> <span class="n">map</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;(</span><span class="mi">4</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"methodLogFlag"</span><span class="o">,</span> <span class="n">methodLogFlag</span><span class="o">);</span>
        <span class="n">map</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"httpInfoFlag"</span><span class="o">,</span> <span class="n">httpInfoFlag</span><span class="o">);</span>

        <span class="k">return</span> <span class="n">map</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 设置方法信息,如参数,方法名等
     */</span>
    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">buildMethodInfo</span><span class="o">(</span><span class="nc">MethodLogInfo</span> <span class="n">methodLogInfo</span><span class="o">,</span> <span class="nc">ProceedingJoinPoint</span> <span class="n">joinPoint</span><span class="o">,</span> <span class="kt">boolean</span> <span class="n">httpInfoFlag</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//设置请求头信息</span>
        <span class="nc">ServletRequestAttributes</span> <span class="n">attributes</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ServletRequestAttributes</span><span class="o">)</span> <span class="nc">RequestContextHolder</span><span class="o">.</span><span class="na">getRequestAttributes</span><span class="o">();</span>
        <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">attributes</span> <span class="o">&amp;&amp;</span> <span class="n">httpInfoFlag</span><span class="o">)</span> <span class="o">{</span>
            <span class="nc">HttpServletRequest</span> <span class="n">request</span> <span class="o">=</span> <span class="n">attributes</span><span class="o">.</span><span class="na">getRequest</span><span class="o">();</span>
            <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">httpMap</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;(</span><span class="mi">4</span><span class="o">);</span>
            <span class="n">httpMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"ip"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getRemoteAddr</span><span class="o">());</span>
            <span class="n">httpMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"url"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getRequestURL</span><span class="o">().</span><span class="na">toString</span><span class="o">());</span>
            <span class="n">httpMap</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"httpMethod"</span><span class="o">,</span> <span class="n">request</span><span class="o">.</span><span class="na">getMethod</span><span class="o">());</span>
            <span class="n">methodLogInfo</span><span class="o">.</span><span class="na">setHttpInfo</span><span class="o">(</span><span class="n">httpMap</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="c1">//方法所在的类名(非全类名)</span>
        <span class="nc">String</span> <span class="n">simpleClassName</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">().</span><span class="na">getDeclaringTypeName</span><span class="o">();</span>
        <span class="c1">//方法名</span>
        <span class="nc">String</span> <span class="n">shortMethodName</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
        <span class="c1">//类名#方法名</span>
        <span class="nc">String</span> <span class="n">classMethod</span> <span class="o">=</span> <span class="n">simpleClassName</span> <span class="o">+</span> <span class="s">"#"</span> <span class="o">+</span> <span class="n">shortMethodName</span><span class="o">;</span>

        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">paramMap</span> <span class="o">=</span> <span class="n">getRequestParamsByJoinPoint</span><span class="o">(</span><span class="n">joinPoint</span><span class="o">);</span>

        <span class="n">methodLogInfo</span><span class="o">.</span><span class="na">setClassMethod</span><span class="o">(</span><span class="n">classMethod</span><span class="o">);</span>
        <span class="n">methodLogInfo</span><span class="o">.</span><span class="na">setParamMap</span><span class="o">(</span><span class="n">paramMap</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="cm">/**
     * 获得方法入参信息,key: 参数名, value: 参数值
     */</span>
    <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">getRequestParamsByJoinPoint</span><span class="o">(</span><span class="nc">JoinPoint</span> <span class="n">joinPoint</span><span class="o">)</span> <span class="o">{</span>
        <span class="c1">//参数名</span>
        <span class="nc">String</span><span class="o">[]</span> <span class="n">paramNames</span> <span class="o">=</span> <span class="o">((</span><span class="nc">MethodSignature</span><span class="o">)</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getSignature</span><span class="o">()).</span><span class="na">getParameterNames</span><span class="o">();</span>
        <span class="c1">//参数值</span>
        <span class="nc">Object</span><span class="o">[]</span> <span class="n">paramValues</span> <span class="o">=</span> <span class="n">joinPoint</span><span class="o">.</span><span class="na">getArgs</span><span class="o">();</span>

        <span class="c1">//key:参数名, value:参数值</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">requestParams</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">paramNames</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
            <span class="nc">Object</span> <span class="n">value</span> <span class="o">=</span> <span class="n">paramValues</span><span class="o">[</span><span class="n">i</span><span class="o">];</span>

            <span class="c1">//如果是文件对象</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">MultipartFile</span><span class="o">)</span> <span class="o">{</span>
                <span class="nc">MultipartFile</span> <span class="n">file</span> <span class="o">=</span> <span class="o">(</span><span class="nc">MultipartFile</span><span class="o">)</span> <span class="n">value</span><span class="o">;</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="na">getOriginalFilename</span><span class="o">();</span>  <span class="c1">//获取文件名</span>
            <span class="o">}</span>

            <span class="c1">//排除方法入参中这两类参数</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">value</span> <span class="k">instanceof</span> <span class="nc">HttpServletRequest</span> <span class="o">||</span> <span class="n">value</span> <span class="k">instanceof</span> <span class="nc">HttpServletResponse</span><span class="o">)</span> <span class="o">{</span>
                <span class="k">continue</span><span class="o">;</span>
            <span class="o">}</span>
            <span class="n">requestParams</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="n">paramNames</span><span class="o">[</span><span class="n">i</span><span class="o">],</span> <span class="n">value</span><span class="o">);</span>
        <span class="o">}</span>

        <span class="k">return</span> <span class="n">requestParams</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@Data</span> <span class="c1">//lombok</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MethodLogInfo</span> <span class="o">{</span>
        <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">String</span><span class="o">&gt;</span> <span class="n">httpInfo</span><span class="o">;</span> <span class="c1">//http请求信息</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">classMethod</span><span class="o">;</span> <span class="c1">//方法所在的类+方法名</span>
        <span class="kd">private</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">paramMap</span><span class="o">;</span> <span class="c1">//key: 参数名,value: 参数值</span>
        <span class="kd">private</span> <span class="nc">Object</span> <span class="n">result</span><span class="o">;</span> <span class="c1">//返回结果对象</span>
        <span class="kd">private</span> <span class="nc">String</span> <span class="n">timeCost</span><span class="o">;</span> <span class="c1">//方法耗时ms</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><h3 id="使用demo">使用demo</h3><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="nd">@MethodLog</span><span class="o">(</span><span class="n">httpInfoFlag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span> <span class="c1">//记录http方法信息</span>
<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/testUserInfoDto"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">UserInfoDto</span> <span class="nf">testUserInfoDto</span><span class="o">(</span><span class="nd">@RequestBody</span> <span class="nc">UserInfoDto</span> <span class="n">userInfoDto</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="nc">UserInfoDto</span><span class="o">.</span><span class="na">builder</span><span class="o">().</span><span class="na">idNo</span><span class="o">(</span><span class="s">"8888888888"</span><span class="o">).</span><span class="na">idType</span><span class="o">(</span><span class="n">userInfoDto</span><span class="o">.</span><span class="na">getIdType</span><span class="o">()).</span><span class="na">build</span><span class="o">();</span> <span class="c1">//UserInfoDto使用了lombok的@Builder</span>
<span class="o">}</span>

<span class="c1">//---打印日志如下</span>
<span class="c1">//---MethodLog: {"classMethod":"com.ifuncat.demo.export.methodLogAop.test.TestMethodLogAopController#testUserInfoDto","httpInfo":{"httpMethod":"POST","url":"http://localhost:8080/export/test/methodLogAop/testUserInfoDto","ip":"127.0.0.1"},"paramMap":{"userInfoDto":{"idNo":"123456","idType":"01","userName":"Tom"}},"result":{"idNo":"8888888888","idType":"01"},"timeCost":"0ms"}</span>
</pre></table></code></div></div><h3 id="注意点">注意点</h3><ul><li>SpringAOP的切点都是public方法, 因此不能用于private, default, protected修饰的方法<li>如果需要记录http信息, 设置@MethodLog的属性httpInfoFlag = true<li>如果方法的入参/返回值信息较大, 谨慎使用该切面, 可以单独在该方法上使用@MethodIgnore</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E5%BC%80%E5%8F%91tips/'>开发Tips</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E5%BC%80%E5%8F%91tips/" class="post-tag no-text-decoration" >开发Tips</a> <a href="/tags/%E6%97%A5%E5%BF%97%E4%BC%98%E5%8C%96/" class="post-tag no-text-decoration" >日志优化</a> <a href="/tags/aop/" class="post-tag no-text-decoration" >AOP</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=开发Tips02-AOP+注解实现日志打印方法入参返回值 - ifuncat&url=https://ifuncat.github.io/posts/devTips02-methodLogAspect/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=开发Tips02-AOP+注解实现日志打印方法入参返回值 - ifuncat&u=https://ifuncat.github.io/posts/devTips02-methodLogAspect/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=开发Tips02-AOP+注解实现日志打印方法入参返回值 - ifuncat&url=https://ifuncat.github.io/posts/devTips02-methodLogAspect/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/docker15/">Dcoker系列15-DockerCompose介绍</a><li><a href="/posts/docker16/">Dcoker系列16-DockerCompose部署项目</a><li><a href="/posts/docker11/">Dcoker系列11-Docker网络基本原理</a><li><a href="/posts/docker10/">Dcoker系列10-Docker镜像发布</a><li><a href="/posts/docker07/">Dcoker系列07-多个容器间挂载数据同步</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91/">Java并发</a> <a class="post-tag" href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/">软件安装</a> <a class="post-tag" href="/tags/%E5%BC%80%E5%8F%91tips/">开发Tips</a> <a class="post-tag" href="/tags/%E6%97%A5%E5%BF%97%E4%BC%98%E5%8C%96/">日志优化</a> <a class="post-tag" href="/tags/aop/">AOP</a> <a class="post-tag" href="/tags/faq/">FAQ</a> <a class="post-tag" href="/tags/redis/">Redis</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/devTips01-log+traceId/"><div class="card-body"> <span class="timeago small" > May 8 <i class="unloaded">2021-05-08T20:22:22+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>开发Tips01-日志添加traceId从而快速定位方法调用链</h3><div class="text-muted small"><p> 问题场景描述 一般情况下,通过日志排查问题时,需要确定方法的调用链, 并发低时同一调用链路上的日志往往相隔在一起, 结合关键词容易找到目标日志信息. 如果并发比较高, 多个线程对应的调用链路的日志会糅杂在一起, 给寻找目标日志带来麻烦 解决思路 如果给同一调用链路上的每条日志加上同一唯一的traceId, 那么通过这个traceId就能迅速定位整个调用链路上的所有日志, t...</p></div></div></a></div><div class="card"> <a href="/posts/docker19/"><div class="card-body"> <span class="timeago small" > Jun 15 <i class="unloaded">2021-06-15T23:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dcoker系列19-部署服务到Swarm集群</h3><div class="text-muted small"><p> 一. 准备工作 搭建Swarm集群, 详见上述教程部分 两manager节点, 两worker节点, 搭建成功如下 1 2 3 4 5 6 7 [root@localhost ~]# docker node ls ID HOSTNAME STATUS AVAILABILITY MAN...</p></div></div></a></div><div class="card"> <a href="/posts/docker18/"><div class="card-body"> <span class="timeago small" > Jun 15 <i class="unloaded">2021-06-15T20:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Dcoker系列18-搭建DockerSwarm集群</h3><div class="text-muted small"><p> 一. 准备工作 VMWare搭建4个CentOS7虚拟机, 处于同一内网中, 每个虚拟机均安装了Docker, 安排如下 此为本地测试所用, 实际情况manager节点的数量必须为基数, 才能满足节点选举. 虚拟机内网IP swarm节点类型 192.168.245.157 ma...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/devTips01-log+traceId/" class="btn btn-outline-primary" prompt="Older"><p>开发Tips01-日志添加traceId从而快速定位方法调用链</p></a> <a href="/posts/java-multiThread03/" class="btn btn-outline-primary" prompt="Newer"><p>Java并发03-守护线程/线程的中断</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2021 <a href="https://twitter.com/username">ifuncat</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/docker/">Docker</a> <a class="post-tag" href="/tags/java%E5%B9%B6%E5%8F%91/">Java并发</a> <a class="post-tag" href="/tags/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85/">软件安装</a> <a class="post-tag" href="/tags/%E5%BC%80%E5%8F%91tips/">开发Tips</a> <a class="post-tag" href="/tags/%E6%97%A5%E5%BF%97%E4%BC%98%E5%8C%96/">日志优化</a> <a class="post-tag" href="/tags/aop/">AOP</a> <a class="post-tag" href="/tags/faq/">FAQ</a> <a class="post-tag" href="/tags/redis/">Redis</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://ifuncat.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
